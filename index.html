<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Login Panel</title>
  <style>
    body { font-family: Arial, sans-serif; background:#111; color:#eee; text-align:center; }
    .hidden { display: none; }
    .box { background:#222; padding:20px; margin:20px auto; border-radius:10px; width:340px; }
    button { padding:8px 14px; margin:5px; border:none; border-radius:6px; background:#28a745; color:white; cursor:pointer; }
    button:hover { background:#218838; }
    input, textarea { margin:5px; padding:6px; width:90%; border-radius:6px; border:1px solid #555; background:#333; color:white; }
    textarea { height:100px; }
    pre { text-align:left; background:#111; padding:8px; border-radius:6px; }
  </style>
</head>
<body>
  <h2>üîë Login Panel</h2>

  <!-- Menu awal -->
  <div id="menuAwal" class="box">
    <p>Pilih jenis login:</p>
    <button onclick="showOwnerLogin()">Login Owner</button>
    <button onclick="showMemberLogin()">Login Member</button>
  </div>

  <!-- Form Login Owner -->
  <div id="loginOwner" class="box hidden">
    <h3>Login Owner</h3>
    <input type="text" id="ownerUser" placeholder="Username">
    <input type="password" id="ownerPass" placeholder="Password">
    <button onclick="loginOwner()">Login</button>
    <button onclick="backToMenu()">Kembali</button>
  </div>

  <!-- Form Login Member -->
  <div id="loginMember" class="box hidden">
    <h3>Login Member</h3>
    <input type="text" id="memberUser" placeholder="Username">
    <input type="text" id="memberToken" placeholder="Token">
    <button onclick="loginMember()">Login</button>
    <button onclick="backToMenu()">Kembali</button>
  </div>

  <!-- Dashboard Owner -->
  <div id="dashboardOwner" class="box hidden">
    <h3>üëë Owner Dashboard</h3>
    <button onclick="generateToken()">Generate Token</button>
    <div id="tokenBox"></div>
    <button onclick="showLookupNIK()">Lookup NIK</button>
    <button onclick="showCekNo()">Cek Nomor</button>
    <button onclick="showTracker()">Tracker Link Generator</button>
    <button onclick="logout()">Logout</button>
  </div>

  <!-- Dashboard Member -->
  <div id="dashboardMember" class="box hidden">
    <h3>üôç Member Dashboard</h3>
    <button onclick="showLookupNIK()">Lookup NIK</button>
    <button onclick="showCekNo()">Cek Nomor</button>
    <button onclick="showTracker()">Tracker Link Generator</button>
    <button onclick="logout()">Logout</button>
  </div>

  <!-- Lookup NIK -->
  <div id="lookupNIK" class="box hidden">
    <h3>üîé Lookup NIK</h3>
    <input type="text" id="nikInput" placeholder="Masukkan NIK (16 digit)">
    <button onclick="lookupNIK()">Cari</button>
    <pre id="nikResult"></pre>
    <button onclick="backDashboard()">Kembali</button>
  </div>

  <!-- Cek Nomor -->
  <div id="cekNo" class="box hidden">
    <h3>üì± Cek Nomor</h3>
    <input type="text" id="noInput" placeholder="Masukkan Nomor HP">
    <button onclick="cekNomor()">Cek</button>
    <pre id="noResult"></pre>
    <button onclick="backDashboard()">Kembali</button>
  </div>

  <!-- Tracker Generator -->
  <div id="tracker" class="box hidden">
    <h3>üåê Tracker Link Generator</h3>
    <input type="text" id="redirectUrl" placeholder="Masukkan link tujuan (https://...)">
    <button onclick="makeTrackerLink()">Buat Link Tracker</button>
    <textarea id="trackerLink" readonly></textarea>
    <h4>Log Pengunjung:</h4>
    <pre id="trackerLog"></pre>
    <button onclick="backDashboard()">Kembali</button>
  </div>

<script>
  let currentUser = null;
  let validToken = null;
  let visitorLogs = [];

  // ==== LOGIN SYSTEM ====
  function showOwnerLogin(){ hideAll(); document.getElementById("loginOwner").classList.remove("hidden"); }
  function showMemberLogin(){ hideAll(); document.getElementById("loginMember").classList.remove("hidden"); }
  function backToMenu(){ hideAll(); document.getElementById("menuAwal").classList.remove("hidden"); }

  function loginOwner(){
    const user = document.getElementById("ownerUser").value;
    const pass = document.getElementById("ownerPass").value;
    if(user === "owner" && pass === "1234"){
      currentUser = "owner";
      hideAll();
      document.getElementById("dashboardOwner").classList.remove("hidden");
    } else { alert("Login Owner gagal!"); }
  }

  function loginMember(){
    const token = document.getElementById("memberToken").value;
    if(token && token === validToken){
      currentUser = "member";
      hideAll();
      document.getElementById("dashboardMember").classList.remove("hidden");
    } else { alert("Token salah atau belum dibuat!"); }
  }

  function logout(){
    currentUser = null;
    hideAll();
    document.getElementById("menuAwal").classList.remove("hidden");
  }

  function generateToken(){
    validToken = Math.random().toString(36).substring(2,10).toUpperCase();
    document.getElementById("tokenBox").innerHTML = "<b>Token Member:</b> " + validToken;
  }

  // ==== DASHBOARD ====
  function showLookupNIK(){ hideAll(); document.getElementById("lookupNIK").classList.remove("hidden"); }
  function showCekNo(){ hideAll(); document.getElementById("cekNo").classList.remove("hidden"); }
  function showTracker(){
    hideAll(); 
    document.getElementById("tracker").classList.remove("hidden"); 
    updateLog();
  }

  function backDashboard(){
    hideAll();
    if(currentUser === "owner"){ document.getElementById("dashboardOwner").classList.remove("hidden"); }
    else if(currentUser === "member"){ document.getElementById("dashboardMember").classList.remove("hidden"); }
  }

  function hideAll(){ document.querySelectorAll(".box").forEach(b=>b.classList.add("hidden")); }

  // ==== LOOKUP NIK ====
  function lookupNIK(){
    const nik = document.getElementById("nikInput").value;
    if(!/^\d{16}$/.test(nik)){ alert("NIK harus 16 digit angka!"); return; }
    const tgl = nik.substring(6,8);
    const bln = nik.substring(8,10);
    const thn = nik.substring(10,12);
    let gender = "Laki-Laki"; let tanggal = parseInt(tgl);
    if(tanggal>40){ gender="Perempuan"; tanggal -= 40; }
    const tahun = "19"+thn; // asumsi 1900-an
    const kota = nik.substring(0,4);
    document.getElementById("nikResult").innerText =
      "Tanggal Lahir: "+tanggal+"/"+bln+"/"+tahun+
      "\nJenis Kelamin: "+gender+
      "\nKode Kota: "+kota;
  }

  // ==== CEK NOMOR ====
  const providerMap = {
    "0811":"Telkomsel","0812":"Telkomsel","0857":"Indosat","0856":"Indosat","0838":"Axis","0896":"Tri","0881":"Smartfren"
  };
  function cekNomor(){
    const no = document.getElementById("noInput").value;
    const prefix = no.substring(0,4);
    let provider = providerMap[prefix] || "Tidak diketahui";
    let aktif = (parseInt(no.slice(-1)) % 2 === 0) ? "Aktif" : "Tidak Aktif";
    document.getElementById("noResult").innerText =
      "Provider: "+provider+"\nStatus: "+aktif;
  }

  // ==== TRACKER LINK ====
  function makeTrackerLink(){
    const redirectUrl = document.getElementById("redirectUrl").value;
    if(!redirectUrl.startsWith("http")){ alert("Link tujuan harus diawali http atau https"); return; }
    const link = window.location.origin + window.location.pathname + "?track=" + Date.now() + "&to=" + encodeURIComponent(redirectUrl);
    document.getElementById("trackerLink").value = link;
  }

  function updateLog(){
    let logText = visitorLogs.map(v => 
      `Time: ${v.time}
UA: ${v.ua}
Platform: ${v.platform}
Screen: ${v.screen}
Redirected to: ${v.redirect}
-------------------------`).join("\n");
    document.getElementById("trackerLog").innerText = logText || "Belum ada pengunjung.";
  }

  // ==== TRACKER MODE ====
  function collectVisitor(){
    const url = new URL(window.location.href);
    if(url.searchParams.has("track")){
      const redirect = url.searchParams.get("to") || "https://example.com";
      const v = {
        time: new Date().toLocaleString(),
        ua: navigator.userAgent,
        platform: navigator.platform,
        screen: screen.width+"x"+screen.height,
        redirect: redirect
      };
      visitorLogs.push(v);
      setTimeout(()=>{ window.location.href = redirect; },2000);
    }
  }
  collectVisitor();
</script>
</body>
</html>  <!-- Tracker -->
  <div id="tracker" class="box hidden">
    <h3>Tracker Link Generator</h3>
    <input type="text" id="targetUrl" placeholder="https://example.com">
    <button onclick="generateTracker()">Generate</button>
    <p id="generatedLink"></p>
    <h4>Log Tracking</h4>
    <pre id="logBox">Belum ada data...</pre>
  </div>

  <script>
    const OWNER_PASSWORD = "admin123"; 
    let tokens = JSON.parse(localStorage.getItem("tokens") || "[]");

    // === Data wilayah minimal (kode provinsi 2 digit) ===
    const wilayah = {
      "12": "Sumatera Utara",
      "31": "DKI Jakarta",
      "32": "Jawa Barat",
      "33": "Jawa Tengah",
      "34": "DI Yogyakarta",
      "35": "Jawa Timur",
      "36": "Banten",
      "51": "Bali"
    };

    // === Prefix provider ===
    const provider = {
      "0811":"Telkomsel","0812":"Telkomsel","0813":"Telkomsel","0821":"Telkomsel","0822":"Telkomsel","0823":"Telkomsel",
      "0852":"Telkomsel","0853":"Telkomsel","0851":"Telkomsel",
      "0855":"Indosat","0856":"Indosat","0857":"Indosat","0858":"Indosat","0814":"Indosat","0815":"Indosat","0816":"Indosat",
      "0817":"XL","0818":"XL","0819":"XL","0859":"XL","0877":"XL","0878":"XL",
      "0831":"Axis","0832":"Axis","0833":"Axis","0838":"Axis",
      "0895":"Tri","0896":"Tri","0897":"Tri","0898":"Tri","0899":"Tri",
      "0881":"Smartfren","0882":"Smartfren","0883":"Smartfren","0884":"Smartfren","0885":"Smartfren","0886":"Smartfren","0887":"Smartfren","0888":"Smartfren","0889":"Smartfren"
    };

    // === Login ===
    function login() {
      const type = document.getElementById("loginType").value;
      const input = document.getElementById("loginInput").value.trim();

      if (type === "owner") {
        if (input === OWNER_PASSWORD) {
          sessionStorage.setItem("role", "owner");
          showDashboard();
        } else alert("Password salah!");
      } else {
        if (tokens.includes(input)) {
          sessionStorage.setItem("role", "member");
          showDashboard();
        } else alert("Token tidak valid!");
      }
    }

    function logout() {
      sessionStorage.removeItem("role");
      location.reload();
    }

    function showDashboard() {
      document.getElementById("loginBox").classList.add("hidden");
      let role = sessionStorage.getItem("role");
      if (role === "owner") document.getElementById("ownerBox").classList.remove("hidden");
      if (role === "member") document.getElementById("memberBox").classList.remove("hidden");
    }

    // === Token ===
    function generateToken() {
      const token = "TOKEN-" + Math.random().toString(36).substr(2,8).toUpperCase();
      tokens.push(token);
      localStorage.setItem("tokens", JSON.stringify(tokens));
      showTokens();
    }

    function showTokens() {
      document.getElementById("tokenList").innerText = tokens.length ? tokens.join("\n") : "Belum ada token...";
    }

    // === Lookup NIK (parser resmi) ===
    function lookupNik() {
      const nik = document.getElementById("nikInput").value.trim();
      if (!/^\d{16}$/.test(nik)) {
        alert("NIK harus 16 digit angka!");
        return;
      }
      let kodeProv = nik.substring(0,2);
      let provinsi = wilayah[kodeProv] || "Tidak diketahui";

      let tgl = parseInt(nik.substring(6,8),10);
      let bln = parseInt(nik.substring(8,10),10);
      let thn = parseInt(nik.substring(10,12),10);

      let gender = "Laki-laki";
      if (tgl > 40) { gender = "Perempuan"; tgl -= 40; }

      let tahunFull = thn < 25 ? 2000+thn : 1900+thn;
      let tanggalLahir = `${tgl.toString().padStart(2,"0")}-${bln.toString().padStart(2,"0")}-${tahunFull}`;

      document.getElementById("nikResult").innerText =
        `NIK: ${nik}\nTanggal Lahir: ${tanggalLahir}\nJenis Kelamin: ${gender}\nProvinsi: ${provinsi}`;
    }

    // === Cek Nomor ===
    function cekNomor() {
      const no = document.getElementById("noInput").value.trim();
      if (!/^\d{10,13}$/.test(no)) {
        alert("Masukkan nomor yang benar (10-13 digit)!");
        return;
      }
      let prefix = no.substring(0,4);
      let kartu = provider[prefix] || "Tidak diketahui";

      let status = (parseInt(no.slice(-1)) % 2 === 0) ? "Aktif" : "Tidak Aktif";

      document.getElementById("noResult").innerText =
        `Nomor: ${no}\nJenis Kartu: ${kartu}\nStatus: ${status}`;
    }

    // === Tracker ===
    function generateTracker() {
      let url = document.getElementById("targetUrl").value.trim();
      if (!url) return alert("Masukkan URL!");
      let trackerUrl = window.location.href.split("?")[0] + "?redirect=" + encodeURIComponent(url);
      document.getElementById("generatedLink").innerHTML =
        `Link Tracker: <a href="${trackerUrl}" target="_blank">${trackerUrl}</a>`;
    }

    async function getDeviceInfo(target) {
      return {
        url: target,
        user_agent: navigator.userAgent,
        platform: navigator.platform,
        screen: `${screen.width}x${screen.height}`,
        window: `${window.innerWidth}x${window.innerHeight}`,
        time: new Date().toLocaleString()
      };
    }

    function saveLog(info) {
      let logs = JSON.parse(localStorage.getItem("trackerLogs") || "[]");
      logs.push(info);
      localStorage.setItem("trackerLogs", JSON.stringify(logs));
    }

    function showLogs() {
      let logs = JSON.parse(localStorage.getItem("trackerLogs") || "[]");
      document.getElementById("logBox").innerText = logs.length
        ? logs.map((v,i)=>`[${i+1}] ${v.time}\nUA: ${v.user_agent}\nPlatform: ${v.platform}\nScreen: ${v.screen}\nWindow: ${v.window}\nRedirect: ${v.url}\n---`).join("\n")
        : "Belum ada data...";
    }

    const params = new URLSearchParams(window.location.search);
    if (params.has("redirect")) {
      let target = params.get("redirect");
      getDeviceInfo(target).then(info=>{
        saveLog(info);
        showLogs();
        setTimeout(()=>{ window.location.href = target; },1500);
      });
    } else {
      showLogs();
      showTokens();
      if (sessionStorage.getItem("role")) showDashboard();
    }

    function showSection(id) {
      ["lookupnik","cekno","tracker"].forEach(s=>document.getElementById(s).classList.add("hidden"));
      document.getElementById(id).classList.remove("hidden");
    }
  </script>
</body>
</html>
